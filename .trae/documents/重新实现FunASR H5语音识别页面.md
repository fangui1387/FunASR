## 项目概述
基于UI设计规范和API文档，重新实现一个模块化的H5语音识别页面，支持WebSocket实时音频传输。

## 技术架构

### 1. 目录结构
```
/Users/mengfangui/work/mfg/company/项目管理/2026年后的文档/语音/FunASR/runtime/html5-new/
├── index.html          # 主页面
├── css/
│   └── style.css       # 样式文件
├── js/
│   ├── app.js          # 应用入口/视图层
│   ├── audioRecorder.js # 音频录制模块（业务逻辑层）
│   ├── wsClient.js     # WebSocket通信层
│   ├── errorHandler.js # 错误处理层
│   └── stateManager.js # 状态管理模块
└── lib/
    └── recorder-core.js # 录音核心库（复用原有）
```

### 2. 模块设计

#### 视图层 (app.js)
- 负责UI渲染和事件绑定
- 两个主要界面：录音前界面（按住说话按钮）、录音中界面（声波动画）
- WebSocket服务器地址配置输入框
- 识别结果展示区域

#### 业务逻辑层 (audioRecorder.js)
- 封装Recorder录音库
- 音频数据采集和处理
- 采样率转换（48kHz -> 16kHz）
- 音频数据分块发送

#### WebSocket通信层 (wsClient.js)
- 连接管理（连接、断开、重连）
- 消息处理（发送元信息、音频数据、结束标识）
- 心跳检测
- 符合API.md规范的消息格式

#### 错误处理层 (errorHandler.js)
- 网络异常处理
- 权限拒绝处理
- 设备不支持处理
- WebSocket连接中断处理
- 用户友好的错误提示

#### 状态管理 (stateManager.js)
- 录音前状态
- 录音中状态
- 连接中状态
- 连接异常状态
- 状态切换和UI同步

### 3. 功能特性

#### 核心功能
1. **按住说话**：长按按钮开始录音，松开发送
2. **WebSocket配置**：可配置服务器地址
3. **实时识别**：音频流实时传输，识别结果实时展示
4. **热词支持**：可配置热词提升识别准确率
5. **ITN支持**：逆文本标准化开关

#### 错误处理
- 麦克风权限被拒绝
- 浏览器不支持录音
- WebSocket连接失败
- 网络异常自动重连
- 资源释放保证

#### 性能优化
- 音频数据缓冲和分块发送
- 弱网环境下的重试机制
- 内存泄漏防护
- 移动端兼容性优化

### 4. 兼容性要求
- iOS Safari 12+
- Android Chrome 70+
- 微信内置浏览器
- 支持HTTPS环境

### 5. 实现步骤

1. 创建目录结构和基础HTML
2. 实现CSS样式（参考UI图片设计）
3. 实现状态管理模块
4. 实现错误处理模块
5. 实现WebSocket通信层
6. 实现音频录制模块
7. 实现视图层和应用入口
8. 编写开发文档

### 6. 交付物
- 完整的HTML/CSS/JS代码
- 开发文档（模块设计、接口说明）
- 使用说明