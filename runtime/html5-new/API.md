# FunASR语音识别websocket接口文档
## 1. 简介
FunASR离线语音识别 websocket接口，基于该接口，可实现短语音的极速识别功能。
## 2. 接口
### 2.1 接口要求
<figure>
集成离线语音转写API时，需按照以下要求。
|**内容**| 参数是否必须 | 说明                            |
| ------ | ------ | ----------------------------- |
| 请求协议   |        | ws[s] (为提高安全性，外网推荐采用wss来进行部署) |
| 请求地址   |        | ws[s]: //ip:port              |
</figure>
### 2.2 接口说明
<figure>
接口调用包括3个阶段：元信息发送阶段和语音传输阶段以及关闭阶段。
</figure>
#### 2.2.1 元信息发送阶段
##### 2.2.1.1 发送元信息请求
<figure>
该请求为websocket的文本消息，没有结果返回
### 参数实例
```
{"mode": "offline", "wav_name": "wav_name", "wav_format":"pcm", "is_speaking": True, "hotwords":"{"阿里巴巴":20,"通义实验室":30}", "itn":True}
```
参数说明
|**参数**     |**类型**|**必须**| 示例                     |**说明**                                                              |
| ----------- | ------ | ------ | ---------------------- | -------------------------------------------------------------------- |
| mode        | string | 是      | offline                | 模型的使用方式，目前必须填写offline。                                               |
| wav_name    | string | 是      | abcd                   | 最好是一个独一无二的名字，这样可以和请求关联起来                                             |
| wav_format  | string | 否      | pcm、wav、mp3、mp4        | 音频数据类型，如果是pcm，必须填写pcm，否则填写文件后缀名即可                                    |
| is_speaking | bool   | 是      | True/False             | 一般情况下要填写True，如果数据全部发送完成了填写False                                      |
| audio_fs    | bool   | 否      | 16000                  | 音频采样率，当wav_format 为pcm时必须要写该参数。                                      |
| hotwords    | {}     | 否      | {"阿里巴巴":20,"通义实验室":30} | 热词，用于识别一些专有词汇。一般不需要填写。填写的话是key和value的形式，value从1到100，值越大，识别为该词的概率也越大。 |
| itn         | bool   | 否      | True/False             | 是否做一些文本从汉字到常见符号、数字等的转换，默认为True，会进行转换。例如百分之九十五 会转换成95%                |
| hotword_id  | string | 否      | fqt等                   | 热词列表id。例如fqt表示分期通，默认不用填写。                                            |
</figure>
#### 2.2.2 发送音频数据阶段
##### 2.2.2.1 发送音频数据
<figure>
发送参数：直接是pcm二进制数据，这是一个异步接口，发送数据和获取结果没有一对一的关系。
客户端不断构造binary message发送到服务端，内容是音频的二进制数据，发送频率影响到文字结果展现的实时性，例如100ms发送一次100ms产生的pcm数据等。如果发送速度过快，例如1s发送了100s的数据，可能导致连接断开。
</figure>
</figure>
#### 2.2.3 语音结束阶段
##### 2.2.3.1 发送语音结束标识
<figure>
音频数据上传完成后，客户端需发送一个特殊的文本消息到服务端作为结束标识，客户端可以在音频数据发送完毕后，立即发送结束标记。发送结束标记表示本次通话结束，客户端收到对应的应答消息后，请主动关闭连接，否则服务端将会在连接超时后主动关闭连接。
内容是：
```
{"is_speaking": False}
```
</figure>
##### 2.2.3.2 识别结果返回值
<figure>
因为只会该离线使用模式只会返回一次识别结果，收到上面语音结束后，会立即对所收到的音频进行识别。
```
{"mode": "offline", "wav_name": "wav_name", "text": "asr ouputs", "is_final": False,"timestamp":"[[100,200], [200,500]]","stamp_sents":[]}
```
|**参数**     |**类型**|**取值**                |**注释**                                                          |
| ----------- | ------ | ---------------------- | ---------------------------------------------------------------- |
| mode        | string | offline                | 离线模式下结果只能是offline                                                |
| wav_name    | string | abcd                   | 和请求时保持一致。                                                        |
| text        | String |                        | 识别出的文字，大多数情况下只需要该字段的结果即可                                         |
| is_final    | bool   | False                  | 离线模式下永远都是False，不用关心                                              |
| timestamp   | []     | [[100,200], [200,500]] | 时间戳，表示识别出的每个字在音频中的时间戳，单位是ms，一般情况不用关心 |
| stamp_sents | []     |                        | 句子级别的时间戳，一般情况下不用关心                                               |
</figure>